<Lems xmlns="http://www.neuroml.org/lems/0.7.4"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.neuroml.org/lems/0.7.4 ../../LEMS/Schemas/LEMS/LEMS_v0.7.4.xsd" >

    <ComponentType name="baseRateUnitDL"
                   extends="baseCellMembPotDL"
                   description="Base type of any cell/population which has a (dimensionless) rate _r.">
              <Exposure name="R" dimension="none"/>
    </ComponentType>

    <ComponentType  name="wilsonCowanCell"
                    extends="baseRateUnitDL"
                    description="...">

        <Parameter name="tau" dimension="time"/>
        <Parameter name="R0" dimension="none"/>
        <Parameter name="z" dimension="none"/>

        <Attachments name="synapses" type="basePointCurrentDL"/>

        <Exposure name="f" dimension="none"/>
        <Exposure name="iSyn" dimension="none"/>

        <Dynamics>

            <StateVariable name="R" dimension="none" exposure="R" description="Rate..."/>

            <DerivedVariable name="iSyn" dimension="none" exposure="iSyn" select="synapses[*]/I" reduce="add" />

            <DerivedVariable name="f" dimension="none" exposure="f" value="1 / (1 + exp(-1*(iSyn - z)))"/>

            <TimeDerivative variable="R" value="(-1*R + f)/tau"/>

            <OnStart>
                <StateAssignment variable="R" value="R0"/>
            </OnStart>

            <!-- On condition is not need on the model but NeuroML requires its definition -->
            <OnCondition test="R .gt. 1000*R0">
                <EventOut port="spike"/>
            </OnCondition>

        </Dynamics>

    </ComponentType>

    <ComponentType name="silentSynapseDL"
                   extends="baseGradedSynapse"
                   description="Dummy synapse which emits no current. Used as presynaptic endpoint for analog synaptic connection.">

        <Property name="weight" dimension="none" defaultValue="1"/> <!-- Not used...-->

        <Exposure name="I" dimension="none"/>

        <InstanceRequirement name="peer" type="baseGradedSynapse"/>

        <Dynamics>
            <DerivedVariable name="rpeer" dimension="none" select="peer/R"/>
            <DerivedVariable name="I" exposure="I"  value="0"/>
        </Dynamics>

    </ComponentType>

    <ComponentType name="rateSynapseDL"
                   extends="baseGradedSynapse"
                   description="...">

        <Property name="weight" dimension="none" defaultValue="1"/>

        <Constant name="MSEC" dimension="time" value="1ms"/>
        <Constant name="SEC" dimension="time" value="1s"/>
        <Constant name="PAMP" dimension="current" value="1nA"/>

        <Exposure name="I" dimension="none"/>

        <Requirement name="R" dimension="none"/>

        <InstanceRequirement name="peer" type="rateSynapseDL"/>

        <Dynamics>
            <DerivedVariable name="rpeer" dimension="none" select="peer/R"/>
            <DerivedVariable name="I" exposure="I"  value="weight * SEC * rpeer"/>
        </Dynamics>
    </ComponentType>

</Lems>
